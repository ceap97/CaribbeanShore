@page "/role-permiso"
@using RefugioVerde.Models
@inject IRoleService RoleService
@inject IPermisoService PermisoService

@code {
    private List<RolePermisoViewModel> rolesPermisos = new();

    protected override async Task OnInitializedAsync()
    {
        var roles = await RoleService.GetRolesAsync();
        var permisos = await PermisoService.GetPermisosAsync();

        rolesPermisos = roles.Select(role => new RolePermisoViewModel
            {
                RolId = role.RolId,
                NombreRol = role.Nombre,
                Permisos = permisos.Select(permiso => new PermisoViewModel
                {
                    PermisoId = permiso.PermisoId,
                    NombrePermiso = permiso.Nombre,
                    Asignado = role.Permisos.Any(rp => rp.PermisoId == permiso.PermisoId)
                }).ToList()
            }).ToList();
    }
}

<h3>Roles y Permisos</h3>

@if (rolesPermisos == null || !rolesPermisos.Any())
{
    <p>Cargando roles y permisos...</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Rol</th>
                <th>Permisos</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var rolePermiso in rolesPermisos)
            {
                <tr>
                    <td>@rolePermiso.NombreRol</td>
                    <td>
                        <ul>
                            @foreach (var permiso in rolePermiso.Permisos)
                            {
                                <li>
                                    <input type="checkbox" disabled="disabled" checked="@permiso.Asignado" />
                                    @permiso.NombrePermiso
                                </li>
                            }
                        </ul>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
